import{q as H,r as I}from"./chunk-j91n0wcr.js";class K extends H{static baseClass="au-fetch";static observedAttributes=["url","method","auto","interval"];state="idle";data=null;error=null;_controller=null;_intervalId=null;connectedCallback(){if(this._loadingTemplate=this.#k(this.querySelector('template[slot="loading"]')?.innerHTML||"<au-spinner></au-spinner>"),this._errorTemplate=this.#k(this.querySelector('template[slot="error"]')?.innerHTML||'<au-alert variant="error">Error loading data</au-alert>'),this._emptyTemplate=this.#k(this.querySelector('template[slot="empty"]')?.innerHTML||"<p>No data</p>"),super.connectedCallback(),this.has("auto")||this.hasAttribute("url"))this.fetch();let x=parseInt(this.attr("interval","0"));if(x>0)this.setInterval(()=>this.fetch(),x)}render(){switch(this.innerHTML="",this.state){case"loading":let x=document.createElement("div");x.className="au-fetch__loading",x.innerHTML=this._loadingTemplate,this.appendChild(x);break;case"error":let B=document.createElement("div");B.className="au-fetch__error";let q=this.error?.message||"Unknown error";if(this._errorTemplate&&this._errorTemplate.includes("${error}"))B.textContent=`Error: ${q}`;else{let k=document.createElement("au-alert");k.setAttribute("variant","error"),k.textContent=q,B.appendChild(k)}this.appendChild(B);break;case"success":if(!this.data||Array.isArray(this.data)&&this.data.length===0){let k=document.createElement("div");k.className="au-fetch__empty",k.innerHTML=this._emptyTemplate,this.appendChild(k)}else{let k=document.createElement("div");if(k.className="au-fetch__data",this.renderItem&&Array.isArray(this.data))this.data.forEach((D)=>{let G=this.renderItem(D);if(G instanceof Node)k.appendChild(G);else k.insertAdjacentHTML("beforeend",G)});else{let D=document.createElement("slot");D.name="data",k.appendChild(D),this.emit("au-data",{data:this.data})}this.appendChild(k)}break}}async fetch(x={}){let B=this.attr("url","");if(!B)return console.warn("au-fetch: No URL provided"),null;if(this._controller)this._controller.abort();this._controller=new AbortController,this.state="loading",this.error=null,this.render(),this.emit("au-loading");try{let q=this.attr("method","GET"),k=await fetch(B,{method:q,signal:this._controller.signal,headers:{"Content-Type":"application/json",...x.headers},...x});if(!k.ok){let D=`HTTP ${k.status}: ${k.statusText}`;try{let G=await k.json();if(G.message)D=G.message}catch(G){}throw Error(D)}return this.data=await k.json(),this.state="success",this.render(),this.emit("au-success",{data:this.data}),this.data}catch(q){if(q.name==="AbortError")return null;return this.error=q,this.state="error",this.render(),this.emit("au-error",{error:this.error}),null}}refetch(){return this.fetch()}set renderItem(x){this._renderItem=x}get renderItem(){return this._renderItem}update(x,B,q){if(x==="url"&&B!==q)this.fetch()}disconnectedCallback(){if(super.disconnectedCallback(),this._controller)this._controller.abort()}#k(x){let B=document.createElement("div");B.innerHTML=x,B.querySelectorAll("script, iframe, object, embed, base, meta[http-equiv]").forEach((q)=>q.remove());for(let q of B.querySelectorAll("*"))for(let k of[...q.attributes]){if(k.name.startsWith("on"))q.removeAttribute(k.name);if(k.name==="srcdoc")q.removeAttribute(k.name);if(["href","src","action","formaction"].includes(k.name)&&k.value.trim().toLowerCase().startsWith("javascript:"))q.removeAttribute(k.name)}return B.innerHTML}}I("au-fetch",K);export{K as AuFetch};
