import{p as H,q as K}from"./chunk-gkgym1ts.js";class L extends H{static baseClass="au-fetch";static observedAttributes=["url","method","auto","interval"];state="idle";data=null;error=null;_controller=null;_intervalId=null;connectedCallback(){if(this._loadingTemplate=this.querySelector('template[slot="loading"]')?.innerHTML||"<au-spinner></au-spinner>",this._errorTemplate=this.querySelector('template[slot="error"]')?.innerHTML||'<au-alert variant="error">Error loading data</au-alert>',this._emptyTemplate=this.querySelector('template[slot="empty"]')?.innerHTML||"<p>No data</p>",super.connectedCallback(),this.has("auto")||this.hasAttribute("url"))this.fetch();let x=parseInt(this.attr("interval","0"));if(x>0)this.setInterval(()=>this.fetch(),x)}render(){switch(this.innerHTML="",this.state){case"loading":let x=document.createElement("div");x.className="au-fetch__loading",x.innerHTML=this._loadingTemplate,this.appendChild(x);break;case"error":let z=document.createElement("div");z.className="au-fetch__error";let B=this.error?.message||"Unknown error";if(this._errorTemplate&&this._errorTemplate.includes("${error}"))z.textContent=`Error: ${B}`;else{let q=document.createElement("au-alert");q.setAttribute("variant","error"),q.textContent=B,z.appendChild(q)}this.appendChild(z);break;case"success":if(!this.data||Array.isArray(this.data)&&this.data.length===0){let q=document.createElement("div");q.className="au-fetch__empty",q.innerHTML=this._emptyTemplate,this.appendChild(q)}else{let q=document.createElement("div");if(q.className="au-fetch__data",this.renderItem&&Array.isArray(this.data))this.data.forEach((D)=>{let G=this.renderItem(D);if(G instanceof Node)q.appendChild(G);else q.insertAdjacentHTML("beforeend",G)});else{let D=document.createElement("slot");D.name="data",q.appendChild(D),this.emit("au-data",{data:this.data})}this.appendChild(q)}break}}async fetch(x={}){let z=this.attr("url","");if(!z)return console.warn("au-fetch: No URL provided"),null;if(this._controller)this._controller.abort();this._controller=new AbortController,this.state="loading",this.error=null,this.render(),this.emit("au-loading");try{let B=this.attr("method","GET"),q=await fetch(z,{method:B,signal:this._controller.signal,headers:{"Content-Type":"application/json",...x.headers},...x});if(!q.ok){let D=`HTTP ${q.status}: ${q.statusText}`;try{let G=await q.json();if(G.message)D=G.message}catch(G){}throw Error(D)}return this.data=await q.json(),this.state="success",this.render(),this.emit("au-success",{data:this.data}),this.data}catch(B){if(B.name==="AbortError")return null;return this.error=B,this.state="error",this.render(),this.emit("au-error",{error:this.error}),null}}refetch(){return this.fetch()}set renderItem(x){this._renderItem=x}get renderItem(){return this._renderItem}update(x,z,B){if(x==="url"&&z!==B)this.fetch()}disconnectedCallback(){if(super.disconnectedCallback(),this._controller)this._controller.abort()}}K("au-fetch",L);export{L as AuFetch};
