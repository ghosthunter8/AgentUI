import{k as _}from"./chunk-vn6j5t8n.js";import{p as Z}from"./chunk-yzw087eq.js";import{q as X,r as Y}from"./chunk-j91n0wcr.js";class $ extends X{static baseClass="au-router";static observedAttributes=["base","default"];#B=/*@__PURE__*/new Map;#q=null;connectedCallback(){super.connectedCallback(),this.listen(window,"hashchange",()=>this.#F()),this.#F()}render(){this.innerHTML='<div class="au-router__content"></div>'}get#G(){return this.attr("base","/app/pages")}get#J(){return this.attr("default","home")}get#K(){return this.querySelector(".au-router__content")}async#F(){let q=window.location.hash.slice(1)||this.#J;if(q===this.#q)return;let B=this.#q;this.#q=q,this.emit("au-route-change",{route:q}),_.emit("au:route-change",{route:q,previous:B}),await this.#M(q)}async#M(q){let B=this.#K;if(!B)return;B.innerHTML="<au-spinner></au-spinner>";try{if(this.#B.has(q)){B.innerHTML=this.#B.get(q),this.emit("au-page-loaded",{route:q});return}let F=`${this.#G}/${q}.html`,K=await fetch(F);if(!K.ok)throw Error(`Page not found: ${q}`);let G=await K.text(),M=new DOMParser().parseFromString(G,"text/html").querySelector("au-page");if(M){let Q=M.querySelector("template"),k=Q?Q.innerHTML:M.innerHTML,U=this._sanitizePageContent(k);this.#B.set(q,U),B.innerHTML=U;let V=M.querySelector('script[type="x-dependencies"]');if(V)await this.#O(V.textContent);let W=M.getAttribute("title");if(W)document.title=`${W} | AgentUI`}else B.textContent=G;this.emit("au-page-loaded",{route:q})}catch(F){B.innerHTML=Z`<au-alert variant="error"> <strong>Page not found</strong> <p>Could not load page: ${q}</p> </au-alert>`,this.emit("au-page-error",{route:q,error:F})}}_sanitizePageContent(q){let B;if(typeof DOMParser<"u")B=new DOMParser().parseFromString(q,"text/html");else{let G=document.createElement("div");G.innerHTML=q,B={body:G}}let F="script, iframe, object, embed, base, meta[http-equiv]";B.body.querySelectorAll(F).forEach((G)=>G.remove());let K=B.body.querySelectorAll("*");for(let G of K){let O=[...G.attributes];for(let J of O){if(J.name.startsWith("on"))G.removeAttribute(J.name);if(J.name==="srcdoc")G.removeAttribute(J.name);if(["href","src","action","formaction"].includes(J.name)){if(J.value.trim().toLowerCase().startsWith("javascript:"))G.removeAttribute(J.name)}}}return B.body.innerHTML}async#O(q){let B=q.split(/[\n,]/).map((F)=>F.trim()).filter((F)=>F&&/^au-[a-z0-9-]+$/.test(F));for(let F of B){if(customElements.get(F))continue;try{await import(`/dist/components/${F}.js`)}catch(K){console.warn(`[au-router] Could not load: ${F}`,K)}}}navigate(q){window.location.hash=q}get currentRoute(){return this.#q}}Y("au-router",$);export{$ as AuRouter};
