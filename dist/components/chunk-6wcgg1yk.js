var Z=typeof window<"u"?window:globalThis,U=["ui:toast","ui:modal","ui:theme","ui:tabs","ui:dropdown","ui:form","ui:grid","ui:stack","ui:virtual-list"],O={type:"ui-framework",version:"0.1.144",description:"AI-Optimized UI Framework - Web Components Edition"};class F{#j=/*@__PURE__*/new Map;#q=/*@__PURE__*/new Map;#z=/*@__PURE__*/new Map;#J=/*@__PURE__*/new Set;#Q=/*@__PURE__*/new Set;#V=100;#W=!1;#X=Date.now();peerId;capabilities;meta;constructor(j={}){this.peerId=j.peerId??"default",this.capabilities=j.capabilities??[],this.meta=j.meta??{},this.#W=j.debug??!1}on(j,q){if(j.endsWith("*")){let V=j.slice(0,-1);if(!this.#q.has(V))this.#q.set(V,/*@__PURE__*/new Set);return this.#q.get(V).add(q),{unsubscribe:()=>this.#q.get(V)?.delete(q)}}if(!this.#j.has(j))this.#j.set(j,/*@__PURE__*/new Set);let z=q;this.#j.get(j).add(z);let Q=this.#j.get(j).size;if(Q>this.#V)console.warn(`[AgentUI] Possible event leak: "${j}" has ${Q} listeners (maxListeners: ${this.#V}). Use setMaxListeners() to increase.`);return{unsubscribe:()=>this.#j.get(j)?.delete(z)}}off(j,q){if(j.endsWith("*")){let z=j.slice(0,-1);this.#q.get(z)?.delete(q);return}this.#j.get(j)?.delete(q)}emitSync(j,q){let z={event:j,data:q};for(let W of this.#Q)z=W(z,{event:j})??z;let Q=z;for(let W of this.#J)Q=W(Q,{event:j})??Q;let V=this.#j.get(j);if(V)for(let W of V)W(Q);for(let[W,K]of this.#q)if(j.startsWith(W))for(let D of K)D(Q)}async emit(j,q){return this.emitSync(j,q),{delivered:!0,event:j}}signal(j,q){this.emitSync(j,q)}hasListeners(j){return(this.#j.get(j)?.size??0)>0}handle(j,q){return this.#z.set(j,q),{unsubscribe:()=>this.#z.delete(j)}}unhandle(j){this.#z.delete(j)}async request(j,q,z){let Q=this.#z.get(q);if(!Q)throw Error(`No handler for '${q}'`);return Q(z)}async broadcastRequest(j,q){return this.request(this.peerId,j,q)}addInboundHook(j){return this.#J.add(j),()=>this.#J.delete(j)}addOutboundHook(j){return this.#Q.add(j),()=>this.#Q.delete(j)}setMaxListeners(j){this.#V=j}get debug(){return this.#W}get peers(){return[]}get peerCount(){return 0}healthCheck(){return{status:"healthy",peerId:this.peerId,uptime:Date.now()-this.#X,listeners:this.#j.size,handlers:this.#z.size}}destroy(){this.#j.clear(),this.#z.clear(),this.#J.clear(),this.#Q.clear()}}if(!Z.__AGENTUI_BUS__)Z.__AGENTUI_BUS__=new F({peerId:"agentui",capabilities:U,meta:O});var J=Z.__AGENTUI_BUS__,$="__AGENTUI_COMPONENT_REGISTRY__";if(!Z[$])Z[$]=/*@__PURE__*/new Map;var Y=Z[$],X=/*@__PURE__*/new WeakMap,G={on(j,q){let z=(V)=>{q(V.data??V)};if(!X.has(q))X.set(q,/*@__PURE__*/new Map);X.get(q).set(j,z);let Q=J.on(j,z);return()=>{Q.unsubscribe(),X.get(q)?.delete(j)}},once(j,q){let z=this.on(j,(Q)=>{z(),q(Q)})},off(j,q){let z=X.get(q)?.get(j);if(z)J.off(j,z),X.get(q)?.delete(j)},emit(j,q){return J.emitSync(j,q)},async emitAsync(j,q){return J.emit(j,q)},signal(j,q){J.signal(j,q)},async request(j,q,z){return J.request(j,q,z)},async broadcastRequest(j,q){return J.broadcastRequest(j,q)},handle(j,q){return J.handle(j,q)},unhandle(j){J.unhandle(j)},destroy(){J.destroy()},setMaxListeners(j){J.setMaxListeners(j)},get peerId(){return J.peerId},get peers(){return J.peers},get peerCount(){return J.peerCount},hasListeners(j){return J.hasListeners(j)},get raw(){return J}},L={TOAST_SHOW:"ui:toast:show",TOAST_DISMISS:"ui:toast:dismiss",MODAL_OPEN:"ui:modal:open",MODAL_CLOSE:"ui:modal:close",THEME_CHANGE:"ui:theme:change",TAB_CHANGE:"ui:tab:change",DROPDOWN_SELECT:"ui:dropdown:select",FORM_SUBMIT:"ui:form:submit",FORM_VALIDATE:"ui:form:validate"};var H=(j,q)=>{Y.set(j,{...q,registeredAt:Date.now()})};
export{G as n,L as o,H as p};
