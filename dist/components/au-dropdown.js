import{o as T}from"./chunk-0f7ph7sp.js";import{p as L,q as Q}from"./chunk-4tm8p8jh.js";class U extends L{static baseClass="au-dropdown";static cssFile="input";static observedAttributes=["placeholder","value","disabled"];#k=null;#q=null;#z=[];#B=!1;connectedCallback(){super.connectedCallback(),this.listen(window,"scroll",()=>this.#C(),{capture:!0,passive:!0}),this.listen(window,"resize",()=>this.#C(),{passive:!0})}disconnectedCallback(){super.disconnectedCallback(),this.#k?.remove()}attributeChangedCallback(k,z,F){if(!this.isConnected||z===F)return;if(k==="value"&&F!==null&&!this.#B){let B=this.#z.find((C)=>C.value===F);if(B){let C=this.querySelector(".au-dropdown__value");if(C)C.textContent=B.label;this.#k?.querySelectorAll(".au-dropdown__option").forEach((J)=>J.classList.toggle("is-active",J.getAttribute("data-value")===F))}}if(k==="disabled"){let B=this.querySelector(".au-dropdown__trigger");if(B)B.disabled=this.hasAttribute("disabled")}}render(){if(this.querySelector(".au-dropdown__trigger")&&this.#k)return;requestAnimationFrame(()=>this.#F())}#F(){if(this.querySelector(".au-dropdown__trigger")&&this.#k)return;let k=this.getAttribute("placeholder")||"Select",z=this.querySelectorAll("au-option"),F=this.querySelectorAll("option"),B=z.length>0?z:F;this.#z=Array.from(B).map((q)=>({value:q.getAttribute("value")||q.textContent.trim(),label:q.textContent.trim(),selected:q.hasAttribute("selected")})),this.#q=document.createElement("button"),this.#q.className="au-dropdown__trigger",this.#q.type="button";let C=`au-dropdown-menu-${Math.random().toString(36).slice(2,9)}`;this.#q.setAttribute("aria-haspopup","listbox"),this.#q.setAttribute("aria-expanded","false"),this.#q.setAttribute("aria-label",k),this.#q.setAttribute("popovertarget",C),this.#q.innerHTML=T`
            <span class="au-dropdown__value">${k}</span>
            <svg class="au-dropdown__arrow" width="10" height="6" viewBox="0 0 10 6" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M1 1l4 4 4-4"/>
            </svg>
        `,this.listen(this.#q,"keydown",(q)=>{if(!this.hasAttribute("disabled")){if(q.key==="ArrowDown"||q.key==="Enter"||q.key===" ")q.preventDefault(),this.open()}}),this.innerHTML="",this.appendChild(this.#q),this.#k=document.createElement("div"),this.#k.id=C,this.#k.className="au-dropdown__menu",this.#k.setAttribute("popover","auto"),this.#k.setAttribute("role","listbox"),this.#k.tabIndex=-1,this.listen(this.#k,"toggle",(q)=>{if(q.newState==="open")this.classList.add("is-open"),this.#q?.setAttribute("aria-expanded","true"),this.#C(),requestAnimationFrame(()=>{let G=this.getAttribute("value");(G?this.#k.querySelector(`[data-value="${G}"]`):this.#k.firstChild)?.focus()});else this.classList.remove("is-open"),this.#q?.setAttribute("aria-expanded","false")}),this.listen(this.#k,"keydown",(q)=>this.#G(q)),this.#z.forEach((q)=>{let G=document.createElement("div");G.className="au-dropdown__option",G.setAttribute("data-value",q.value),G.textContent=q.label,G.setAttribute("role","option"),G.tabIndex=-1,this.listen(G,"click",()=>this.select(q.value,q.label)),this.#k.appendChild(G)}),this.appendChild(this.#k);let J=this.#z.find((q)=>q.selected);if(J)this.select(J.value,J.label)}#G(k){let z=Array.from(this.#k.querySelectorAll(".au-dropdown__option")),F=document.activeElement,B=z.indexOf(F);if(k.key==="ArrowDown")k.preventDefault(),(z[B+1]||z[0])?.focus();else if(k.key==="ArrowUp")k.preventDefault(),(z[B-1]||z[z.length-1])?.focus();else if(k.key==="Enter"||k.key===" "){if(k.preventDefault(),B>=0){let C=this.#z[B];this.select(C.value,C.label)}}else if(k.key==="Escape")k.preventDefault(),this.close(),this.#q?.focus()}#C(){if(!this.#k||!this.#q)return;let k=this.#q.getBoundingClientRect(),z=this.#k.scrollHeight||200,C=window.innerHeight-k.bottom-8<z&&k.top>z?k.top-z-4:k.bottom+4;Object.assign(this.#k.style,{position:"fixed",margin:"0",top:`${C}px`,left:`${k.left}px`,width:`${k.width}px`,minWidth:"160px",maxHeight:"280px"})}toggle(){if(this.#k?.matches(":popover-open"))this.close();else this.open()}open(){if(this.hasAttribute("disabled")||!this.#k)return;this.#k.showPopover()}close(){if(this.#k?.matches(":popover-open"))this.#k.hidePopover()}select(k,z){this.#B=!0;let F=this.querySelector(".au-dropdown__value");if(F)F.textContent=z;this.setAttribute("value",k),this.#k?.querySelectorAll(".au-dropdown__option").forEach((B)=>B.classList.toggle("is-active",B.getAttribute("data-value")===k)),this.emit("au-select",{value:k,label:z}),this.close(),this.#B=!1}get value(){return this.getAttribute("value")||""}set value(k){this.setAttribute("value",k)}}class W extends L{static baseClass="au-dropdown__option";connectedCallback(){super.connectedCallback(),this.setAttribute("role","option")}render(){}}Q("au-dropdown",U);Q("au-option",W);export{W as AuOption,U as AuDropdown};
