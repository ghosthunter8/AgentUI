var o=typeof window<"u"?window:globalThis,p=["ui:toast","ui:modal","ui:theme","ui:tabs","ui:dropdown","ui:form","ui:grid","ui:stack","ui:virtual-list"],f={type:"ui-framework",version:"0.1.144",description:"AI-Optimized UI Framework - Web Components Edition"};class d{#e=new Map;#t=new Map;#s=new Set;#i=new Set;#r=100;#n=!1;#a=Date.now();peerId;capabilities;meta;constructor(e={}){this.peerId=e.peerId??"default",this.capabilities=e.capabilities??[],this.meta=e.meta??{},this.#n=e.debug??!1}on(e,t){if(!this.#e.has(e))this.#e.set(e,new Set);let s=t;this.#e.get(e).add(s);let r=this.#e.get(e).size;if(r>this.#r)console.warn(`[AgentUI] Possible event leak: "${e}" has ${r} listeners (maxListeners: ${this.#r}). Use setMaxListeners() to increase.`);return{unsubscribe:()=>this.#e.get(e)?.delete(s)}}off(e,t){this.#e.get(e)?.delete(t)}emitSync(e,t){let s={event:e,data:t};for(let n of this.#i)s=n(s,{event:e})??s;let r=s;for(let n of this.#s)r=n(r,{event:e})??r;let u=this.#e.get(e);if(u)for(let n of u)n(r);for(let[n,l]of this.#e)if(n.endsWith("*")&&e.startsWith(n.slice(0,-1))&&n!==e)for(let c of l)c(r)}async emit(e,t){return this.emitSync(e,t),{delivered:!0,event:e}}signal(e,t){this.emitSync(e,t)}hasListeners(e){return(this.#e.get(e)?.size??0)>0}handle(e,t){return this.#t.set(e,t),{unsubscribe:()=>this.#t.delete(e)}}unhandle(e){this.#t.delete(e)}async request(e,t,s){let r=this.#t.get(t);if(!r)throw Error(`No handler for '${t}'`);return r(s)}async broadcastRequest(e,t){return this.request(this.peerId,e,t)}addInboundHook(e){return this.#s.add(e),()=>this.#s.delete(e)}addOutboundHook(e){return this.#i.add(e),()=>this.#i.delete(e)}setMaxListeners(e){this.#r=e}get debug(){return this.#n}get peers(){return[]}get peerCount(){return 0}healthCheck(){return{status:"healthy",peerId:this.peerId,uptime:Date.now()-this.#a,listeners:this.#e.size,handlers:this.#t.size}}destroy(){this.#e.clear(),this.#t.clear(),this.#s.clear(),this.#i.clear()}}if(!o.__AGENTUI_BUS__)o.__AGENTUI_BUS__=new d({peerId:"agentui",capabilities:p,meta:f});var i=o.__AGENTUI_BUS__,h="__AGENTUI_COMPONENT_REGISTRY__";if(!o[h])o[h]=new Map;var g=o[h],a=new WeakMap,_={on(e,t){let s=(u)=>{t(u.data??u)};if(!a.has(t))a.set(t,new Map);a.get(t).set(e,s);let r=i.on(e,s);return()=>{r.unsubscribe(),a.get(t)?.delete(e)}},once(e,t){let s=this.on(e,(r)=>{s(),t(r)})},off(e,t){let s=a.get(t)?.get(e);if(s)i.off(e,s),a.get(t)?.delete(e)},emit(e,t){return i.emitSync(e,t)},async emitAsync(e,t){return i.emit(e,t)},signal(e,t){i.signal(e,t)},async request(e,t,s){return i.request(e,t,s)},async broadcastRequest(e,t){return i.broadcastRequest(e,t)},handle(e,t){return i.handle(e,t)},unhandle(e){i.unhandle(e)},destroy(){i.destroy()},setMaxListeners(e){i.setMaxListeners(e)},get peerId(){return i.peerId},get peers(){return i.peers},get peerCount(){return i.peerCount},hasListeners(e){return i.hasListeners(e)},get raw(){return i}},m={TOAST_SHOW:"ui:toast:show",TOAST_DISMISS:"ui:toast:dismiss",MODAL_OPEN:"ui:modal:open",MODAL_CLOSE:"ui:modal:close",THEME_CHANGE:"ui:theme:change",TAB_CHANGE:"ui:tab:change",DROPDOWN_SELECT:"ui:dropdown:select",FORM_SUBMIT:"ui:form:submit",FORM_VALIDATE:"ui:form:validate"},w=(e,t)=>{g.set(e,{...t,registeredAt:Date.now()})};
export{_ as d,m as e,w as f};
