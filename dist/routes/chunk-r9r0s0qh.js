var h=typeof window<"u"?window:globalThis,f=["ui:toast","ui:modal","ui:theme","ui:tabs","ui:dropdown","ui:form","ui:grid","ui:stack","ui:virtual-list"],p={type:"ui-framework",version:"0.1.144",description:"AI-Optimized UI Framework - Web Components Edition"};class d{#e=/*@__PURE__*/new Map;#t=/*@__PURE__*/new Map;#s=/*@__PURE__*/new Map;#i=/*@__PURE__*/new Set;#r=/*@__PURE__*/new Set;#n=100;#a=!1;#u=Date.now();peerId;capabilities;meta;constructor(e={}){this.peerId=e.peerId??"default",this.capabilities=e.capabilities??[],this.meta=e.meta??{},this.#a=e.debug??!1}on(e,t){if(e.endsWith("*")){let n=e.slice(0,-1);if(!this.#t.has(n))this.#t.set(n,/*@__PURE__*/new Set);return this.#t.get(n).add(t),{unsubscribe:()=>this.#t.get(n)?.delete(t)}}if(!this.#e.has(e))this.#e.set(e,/*@__PURE__*/new Set);let s=t;this.#e.get(e).add(s);let r=this.#e.get(e).size;if(r>this.#n)console.warn(`[AgentUI] Possible event leak: "${e}" has ${r} listeners (maxListeners: ${this.#n}). Use setMaxListeners() to increase.`);return{unsubscribe:()=>this.#e.get(e)?.delete(s)}}off(e,t){if(e.endsWith("*")){let s=e.slice(0,-1);this.#t.get(s)?.delete(t);return}this.#e.get(e)?.delete(t)}emitSync(e,t){let s={event:e,data:t};for(let a of this.#r)s=a(s,{event:e})??s;let r=s;for(let a of this.#i)r=a(r,{event:e})??r;let n=this.#e.get(e);if(n)for(let a of n)a(r);for(let[a,l]of this.#t)if(e.startsWith(a))for(let c of l)c(r)}async emit(e,t){return this.emitSync(e,t),{delivered:!0,event:e}}signal(e,t){this.emitSync(e,t)}hasListeners(e){return(this.#e.get(e)?.size??0)>0}handle(e,t){return this.#s.set(e,t),{unsubscribe:()=>this.#s.delete(e)}}unhandle(e){this.#s.delete(e)}async request(e,t,s){let r=this.#s.get(t);if(!r)throw Error(`No handler for '${t}'`);return r(s)}async broadcastRequest(e,t){return this.request(this.peerId,e,t)}addInboundHook(e){return this.#i.add(e),()=>this.#i.delete(e)}addOutboundHook(e){return this.#r.add(e),()=>this.#r.delete(e)}setMaxListeners(e){this.#n=e}get debug(){return this.#a}get peers(){return[]}get peerCount(){return 0}healthCheck(){return{status:"healthy",peerId:this.peerId,uptime:Date.now()-this.#u,listeners:this.#e.size,handlers:this.#s.size}}destroy(){this.#e.clear(),this.#s.clear(),this.#i.clear(),this.#r.clear()}}if(!h.__AGENTUI_BUS__)h.__AGENTUI_BUS__=new d({peerId:"agentui",capabilities:f,meta:p});var i=h.__AGENTUI_BUS__,o="__AGENTUI_COMPONENT_REGISTRY__";if(!h[o])h[o]=/*@__PURE__*/new Map;var g=h[o],u=/*@__PURE__*/new WeakMap,_={on(e,t){let s=(n)=>{t(n.data??n)};if(!u.has(t))u.set(t,/*@__PURE__*/new Map);u.get(t).set(e,s);let r=i.on(e,s);return()=>{r.unsubscribe(),u.get(t)?.delete(e)}},once(e,t){let s=this.on(e,(r)=>{s(),t(r)})},off(e,t){let s=u.get(t)?.get(e);if(s)i.off(e,s),u.get(t)?.delete(e)},emit(e,t){return i.emitSync(e,t)},async emitAsync(e,t){return i.emit(e,t)},signal(e,t){i.signal(e,t)},async request(e,t,s){return i.request(e,t,s)},async broadcastRequest(e,t){return i.broadcastRequest(e,t)},handle(e,t){return i.handle(e,t)},unhandle(e){i.unhandle(e)},destroy(){i.destroy()},setMaxListeners(e){i.setMaxListeners(e)},get peerId(){return i.peerId},get peers(){return i.peers},get peerCount(){return i.peerCount},hasListeners(e){return i.hasListeners(e)},get raw(){return i}},m={TOAST_SHOW:"ui:toast:show",TOAST_DISMISS:"ui:toast:dismiss",MODAL_OPEN:"ui:modal:open",MODAL_CLOSE:"ui:modal:close",THEME_CHANGE:"ui:theme:change",TAB_CHANGE:"ui:tab:change",DROPDOWN_SELECT:"ui:dropdown:select",FORM_SUBMIT:"ui:form:submit",FORM_VALIDATE:"ui:form:validate"},w=(e,t)=>{g.set(e,{...t,registeredAt:Date.now()})};
export{_ as d,m as e,w as f};
