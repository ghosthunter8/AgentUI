import{d as p}from"./chunk-4j1wr5t0.js";import"./chunk-3nj36bn4.js";import"./chunk-2tk48kjy.js";import"./chunk-x9m15qkh.js";import"./chunk-dgmxccjz.js";import"./chunk-50mhbfgd.js";import{m as o,n as l,q as h}from"./chunk-mre0q7ng.js";class f extends o{static baseClass="au-router";static observedAttributes=["base","default"];#e=/*@__PURE__*/new Map;#t=null;connectedCallback(){super.connectedCallback(),this.listen(window,"hashchange",()=>this.#i()),this.#i()}render(){this.innerHTML='<div class="au-router__content"></div>'}get#r(){return this.attr("base","/app/pages")}get#s(){return this.attr("default","home")}get#a(){return this.querySelector(".au-router__content")}async#i(){let e=window.location.hash.slice(1)||this.#s;if(e===this.#t)return;let t=this.#t;this.#t=e,this.emit("au-route-change",{route:e}),p.emit("au:route-change",{route:e,previous:t}),await this.#n(e)}async#n(e){let t=this.#a;if(!t)return;t.innerHTML="<au-spinner></au-spinner>";try{if(this.#e.has(e)){t.innerHTML=this.#e.get(e),this.emit("au-page-loaded",{route:e});return}let r=`${this.#r}/${e}.html`,a=await fetch(r);if(!a.ok)throw Error(`Page not found: ${e}`);let i=await a.text(),s=new DOMParser().parseFromString(i,"text/html").querySelector("au-page");if(s){let n=s.querySelector("template"),C=n?n.innerHTML:s.innerHTML,u=this._sanitizePageContent(C);this.#e.set(e,u),t.innerHTML=u;let d=s.querySelector('script[type="x-dependencies"]');if(d)await this.#o(d.textContent);let m=s.getAttribute("title");if(m)document.title=`${m} | AgentUI`}else t.textContent=i;this.emit("au-page-loaded",{route:e})}catch(r){t.innerHTML=h`<au-alert variant="error"> <strong>Page not found</strong> <p>Could not load page: ${e}</p> </au-alert>`,this.emit("au-page-error",{route:e,error:r})}}_sanitizePageContent(e){let t;if(typeof DOMParser<"u")t=new DOMParser().parseFromString(e,"text/html");else{let i=document.createElement("div");i.innerHTML=e,t={body:i}}let r="script, iframe, object, embed, base, meta[http-equiv]";t.body.querySelectorAll(r).forEach((i)=>i.remove());let a=t.body.querySelectorAll("*");for(let i of a){let s=[...i.attributes];for(let n of s){if(n.name.startsWith("on"))i.removeAttribute(n.name);if(n.name==="srcdoc")i.removeAttribute(n.name);if(["href","src","action","formaction"].includes(n.name)){if(n.value.trim().toLowerCase().startsWith("javascript:"))i.removeAttribute(n.name)}}}return t.body.innerHTML}async#o(e){let t=e.split(/[\n,]/).map((r)=>r.trim()).filter((r)=>r&&/^au-[a-z0-9-]+$/.test(r));for(let r of t){if(customElements.get(r))continue;try{await import(`/dist/components/${r}.js`)}catch(a){console.warn(`[au-router] Could not load: ${r}`,a)}}}navigate(e){window.location.hash=e}get currentRoute(){return this.#t}}l("au-router",f);class b extends o{static baseClass="au-page";static observedAttributes=["route","title"];get route(){return this.attr("route","")}get pageTitle(){return this.attr("title","")}get dependencies(){let e=this.querySelector('script[type="x-dependencies"]');if(!e)return[];return e.textContent.split(/[\n,]/).map((t)=>t.trim()).filter((t)=>t&&t.startsWith("au-"))}connectedCallback(){if(super.connectedCallback(),this.querySelector("template"))this.render()}render(){let e=this.querySelector("template");if(e){let t=e.content.cloneNode(!0),r=this.querySelector('script[type="x-dependencies"]');if(this.innerHTML="",r)this.appendChild(r);this.appendChild(t)}}}l("au-page",b);var c=[];class g extends o{static baseClass="au-error-boundary";static observedAttributes=["fallback"];#e=!1;#t=null;#r="";connectedCallback(){super.connectedCallback(),this.#r=this.innerHTML,this.listen(this,"error",this.#a.bind(this)),this.listen(window,"error",(e)=>{if(this.#s(e.error))this.#a({detail:{error:e.error,message:e.message}}),e.preventDefault()})}#s(e){if(!e?.stack)return!1;return Array.from(this.querySelectorAll("*")).filter((t)=>t.tagName.startsWith("AU-")).map((t)=>t.tagName.toLowerCase()).some((t)=>e.stack.includes(t))}#a(e){let t=e?.detail?.error||e?.error||e;if(this.#e)return;if(this.#e=!0,this.#t=t,c.push({timestamp:Date.now(),component:this.id||"au-error-boundary",error:{message:t?.message||String(t),stack:t?.stack,name:t?.name},context:{originalContent:this.#r.slice(0,200),parentUrl:window.location.href}}),c.length>50)c.shift();this.#i(),this.emit("au-error",{error:t,boundary:this,recover:()=>this.recover()}),e?.stopPropagation?.()}#i(){let e=this.getAttribute("fallback");if(e){let t=document.createElement("div");t.className="au-error-boundary__fallback",t.setAttribute("role","alert"),t.textContent=e,this.innerHTML="",this.appendChild(t)}else this.innerHTML=h`<div class="au-error-boundary__fallback" role="alert" aria-live="polite"> <au-icon name="error" style="--au-icon-size: 48px; color: var(--md-sys-color-error);"></au-icon> <p class="au-error-boundary__title">Something went wrong</p> <p class="au-error-boundary__message">${this.#t?.message||"An unexpected error occurred"}</p> <au-button variant="outlined" onclick="this.closest('au-error-boundary').recover()"> Try Again </au-button> </div>`;this.classList.add("has-error")}render(){this.style.display="block"}recover(){this.#e=!1,this.#t=null,this.classList.remove("has-error"),this.innerHTML=this.#r,this.emit("au-recover")}get hasError(){return this.#e}get error(){return this.#t}}l("au-error-boundary",g);class y extends o{static baseClass="au-fetch";static observedAttributes=["url","method","auto","interval"];state="idle";data=null;error=null;_controller=null;_intervalId=null;connectedCallback(){if(this._loadingTemplate=this.#e(this.querySelector('template[slot="loading"]')?.innerHTML||"<au-spinner></au-spinner>"),this._errorTemplate=this.#e(this.querySelector('template[slot="error"]')?.innerHTML||'<au-alert variant="error">Error loading data</au-alert>'),this._emptyTemplate=this.#e(this.querySelector('template[slot="empty"]')?.innerHTML||"<p>No data</p>"),super.connectedCallback(),this.has("auto")||this.hasAttribute("url"))this.fetch();let e=parseInt(this.attr("interval","0"));if(e>0)this.setInterval(()=>this.fetch(),e)}render(){switch(this.innerHTML="",this.state){case"loading":let e=document.createElement("div");e.className="au-fetch__loading",e.innerHTML=this._loadingTemplate,this.appendChild(e);break;case"error":let t=document.createElement("div");t.className="au-fetch__error";let r=this.error?.message||"Unknown error";if(this._errorTemplate&&this._errorTemplate.includes("${error}"))t.textContent=`Error: ${r}`;else{let a=document.createElement("au-alert");a.setAttribute("variant","error"),a.textContent=r,t.appendChild(a)}this.appendChild(t);break;case"success":if(!this.data||Array.isArray(this.data)&&this.data.length===0){let a=document.createElement("div");a.className="au-fetch__empty",a.innerHTML=this._emptyTemplate,this.appendChild(a)}else{let a=document.createElement("div");if(a.className="au-fetch__data",this.renderItem&&Array.isArray(this.data))this.data.forEach((i)=>{let s=this.renderItem(i);if(s instanceof Node)a.appendChild(s);else a.insertAdjacentHTML("beforeend",s)});else{let i=document.createElement("slot");i.name="data",a.appendChild(i),this.emit("au-data",{data:this.data})}this.appendChild(a)}break}}async fetch(e={}){let t=this.attr("url","");if(!t)return console.warn("au-fetch: No URL provided"),null;if(this._controller)this._controller.abort();this._controller=new AbortController,this.state="loading",this.error=null,this.render(),this.emit("au-loading");try{let r=this.attr("method","GET"),a=await fetch(t,{method:r,signal:this._controller.signal,headers:{"Content-Type":"application/json",...e.headers},...e});if(!a.ok){let i=`HTTP ${a.status}: ${a.statusText}`;try{let s=await a.json();if(s.message)i=s.message}catch(s){}throw Error(i)}return this.data=await a.json(),this.state="success",this.render(),this.emit("au-success",{data:this.data}),this.data}catch(r){if(r.name==="AbortError")return null;return this.error=r,this.state="error",this.render(),this.emit("au-error",{error:this.error}),null}}refetch(){return this.fetch()}set renderItem(e){this._renderItem=e}get renderItem(){return this._renderItem}update(e,t,r){if(e==="url"&&t!==r)this.fetch()}disconnectedCallback(){if(super.disconnectedCallback(),this._controller)this._controller.abort()}#e(e){let t=document.createElement("div");t.innerHTML=e,t.querySelectorAll("script, iframe, object, embed, base, meta[http-equiv]").forEach((r)=>r.remove());for(let r of t.querySelectorAll("*"))for(let a of[...r.attributes]){if(a.name.startsWith("on"))r.removeAttribute(a.name);if(a.name==="srcdoc")r.removeAttribute(a.name);if(["href","src","action","formaction"].includes(a.name)&&a.value.trim().toLowerCase().startsWith("javascript:"))r.removeAttribute(a.name)}return t.innerHTML}}l("au-fetch",y);class v extends o{static baseClass="au-lazy";static observedAttributes=["root-margin","threshold"];#e=null;#t=!1;connectedCallback(){super.connectedCallback();let e=this.attr("root-margin","200px"),t=parseFloat(this.attr("threshold","0"));this.#e=new IntersectionObserver((r)=>{if(r[0].isIntersecting&&!this.#t)this.#r()},{rootMargin:e,threshold:t}),this.#e.observe(this)}disconnectedCallback(){super.disconnectedCallback(),this.#e?.disconnect()}render(){let e=this.querySelector('[slot="placeholder"]');if(e)e.style.display="block";let t=this.querySelector("template");if(t)t.style.display="none"}#r(){this.#t=!0,this.#e?.disconnect();let e=this.querySelector("template"),t=this.querySelector('[slot="placeholder"]');if(e){let r=e.content.cloneNode(!0);this.appendChild(r),e.remove()}if(t)t.remove();this.emit("au-loaded"),this.classList.add("is-loaded")}load(){if(!this.#t)this.#r()}}l("au-lazy",v);
